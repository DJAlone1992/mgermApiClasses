# Методы взаимодействия

## Основное

Все методы адресуются по префиксу
```
http://<your-server-address>/_mgerm_external
```
Для аутентификации используется Bearer Token

## Описание точек входа

### /departments.php

Точка входа, для получения массива подразделений клиники

#### Параметры

Метод: GET
Параметры: НЕТ

#### Ответ
В ответ получается массив подразделений MgermApiClasses\Classes\Department[]

### /doctorServices.php

Точка входа, для получения массива услуг, которые оказывает врач

#### Параметры

Метод: GET
Параметры:
* department - идентификатор подразделения, в котором проверяются услуги врача
* doctor - идентификатор врача

#### Ответ
В ответ получается массив услуг MgermApiClasses\Classes\Service[]

## /patientScheduledOnDate.php
Точка входа, для получения массива направлений на данный день

#### Параметры

Метод: GET
Параметры:
* obj - Вид направлений
    * 1 - к врачу (по умолчанию)
    * 2 - в кабинет
* date - Дата, на которую происходит проверка (сегодня по умолчанию)

#### Ответ
Список игнорирует пациентов, находящихся в стационаре
Из списка направлений могут быть исключены пациенты по фильтрам:
* Отказ от информационных сообщений в карте пациента
* Список прайс-листов клиники, для пропуска уведомления
* Список услуг клиники, для пропуска уведомления

В ответ получается массив услуг MgermApiClasses\Classes\Referral[]

## /appointment.php

Точка входа для работы с направлениями
### Проверка направления
#### Параметры
Метод: GET
Параметры:
* action = checkAppointment
* recordID - идентификатор записи направления
#### Ответ
Направление удалено:
``` json
{
    "referral":{
        "status":"cancelled"
    }
}
```
Направление есть:
``` json
{
    "referral":{
        "status":"successfully",
        "startDate":<Дата и время начала приема>,
        "endDate":<Дата и время окончания приема>
    }
}
```
### Удаление направления
#### Параметры
Метод: GET
Параметры:
* action = cancelAppointment
* recordID - идентификатор записи направления
* cancelReason - Описание причины отмены направления

#### Ответ
Успешная отмена
HTTP: 200
``` json
{
    "status":"success"
}
```
Ошибка
HTTP 400
### Создание направления
#### Параметры
Метод: GET
Параметры:
* action = makeAppointment
* date - дата записи
* doctorID - ID врача
* time -  Время начала записи
* time_end -  Время окончания записи
* service -  Идентификатор услуги
* comment -  Комментарий
* patientLastName -  Фамилия пациента
* patientFirstName -  Имя пациента
* patientSecondName -  Отчество пациента
* patientBirthDay -  Дата рождения пациента
* patientPhone - Номер телефона пациента
#### Ответ
Успешное создание направления
``` json
{
    "status":"success",
    "record":<Идентификатор записи направления>
}
Ошибка
``` json
{
    "status":"error",
    "reason":<Описание типа ошибки при создании>,
    "code":<Код ошибки при создании>,
}
```
Коды ошибок:
* -1 - Запись на дату в прошлом
* -2 - Ячейка занята
* -3 - У пациента уже есть направление к другому врачу на это же время
* -4 - Номер телефона пациента не распознан

### Корректировка направления
#### Параметры
Метод: GET
Параметры:
* action = editAppointment
* recordID - идентификатор записи направления
* cancelReason - Описание причины отмены направления
* date - дата записи
* doctorID - ID врача
* time -  Время начала записи
* time_end -  Время окончания записи
* service -  Идентификатор услуги
* comment -  Комментарий
* patientLastName -  Фамилия пациента
* patientFirstName -  Имя пациента
* patientSecondName -  Отчество пациента
* patientBirthDay -  Дата рождения пациента
* patientPhone - Номер телефона пациента
#### Ответ
Успешное создание направления
``` json
{
    "status":"success",
    "record":<Идентификатор записи направления>
}
Ошибка
``` json
{
    "status":"error",
    "reason":<Описание типа ошибки при создании>,
    "code":<Код ошибки при создании>,
}
```
Коды ошибок:
* -1 - Запись на дату в прошлом
* -2 - Ячейка занята
* -3 - У пациента уже есть направление к другому врачу на это же время
* -4 - Номер телефона пациента не распознан